# ThreeWeb - 3D MMD模型展示系统

这是一个基于Python Flask后端和Three.js前端的MMD模型在线展示系统，支持PMX格式模型文件的加载、预览和交互操作。

## 功能特性

- 📁 **模型管理**：自动扫描并列出MMD目录中的模型文件（ZIP和PMX格式）
- 📦 **ZIP支持**：支持从ZIP压缩包中提取和加载PMX模型文件
- 🎮 **交互控制**：
  - 鼠标拖拽：旋转模型
  - 鼠标滚轮：缩放场景
  - 右键拖拽：平移相机
  - 旋转控制：开启/关闭模型自动旋转（固定速度）
  - 全屏模式：全屏显示
- 🎨 **优化显示**：自动调整相机位置以完整显示模型
- 📱 **响应式设计**：适配不同屏幕尺寸的设备

## 系统要求

- Python 3.6+
- 现代Web浏览器（支持WebGL）
- 建议使用Chrome、Firefox或Edge浏览器获得最佳体验

## 安装步骤

### 1. 安装Python依赖

```bash
pip install flask flask-cors
```

### 2. 准备模型文件

将您的PMX模型或包含PMX模型的ZIP压缩包放入以下目录：

```
MMD/
```

系统会自动扫描该目录中的所有模型文件。

## 运行系统

只需启动后端服务器即可：

```bash
python backend.py
```

服务将在以下地址运行：
- http://localhost:5000
- 同时支持通过本地网络IP访问（如192.168.x.x:5000）

## 使用方法

1. 打开浏览器，访问 http://localhost:5000
2. 在模型列表页面，点击任意模型名称加载预览
3. 在模型预览页面，您可以：
   - 使用鼠标进行交互操作
   - 使用左下角的控制按钮：
     - 🏠 返回模型列表
     🔄 重新加载当前模型
     🔃 开启/关闭模型自动旋转
     ⛶ 切换全屏显示

## 项目结构

```
ThreeWeb/
├── backend.py              # Python Flask后端服务
├── MMD/                    # 存放MMD模型文件的目录
│   ├── unzipped/           # 解压后的模型文件缓存目录
│   └── *.zip/*.pmx         # 模型文件
├── static/                 # 静态资源目录
│   ├── js/                 # JavaScript文件
│   │   ├── main.js         # 主渲染和模型加载逻辑
│   │   └── modelList.js    # 模型列表处理逻辑
│   └── threejs/            # Three.js相关库文件
│       ├── three.min.js    # Three.js核心库
│       ├── OrbitControls.js # 轨道控制器
│       ├── MMDLoader.js    # MMD模型加载器
│       ├── MMDAnimationHelper.js # MMD动画助手
│       └── ...             # 其他依赖库
├── templates/              # HTML模板目录
│   ├── index.html          # 模型列表页面
│   └── view.html           # 模型预览页面
└── README.md               # 项目说明文档
```

## API接口说明

### GET /api/models

获取所有可用的模型文件列表。

**返回格式：**
```json
{
  "models": [
    {
      "name": "模型名称",
      "path": "模型路径",
      "type": "zip或pmx"
    }
  ]
}
```

### GET /api/extract_and_load

从ZIP文件中提取并加载PMX模型。

**参数：**
- `file_path`：ZIP文件路径

**返回格式：**
```json
{
  "pmx_path": "提取出的PMX文件路径",
  "textures_path": "纹理文件目录路径"
}
```

## 技术细节

- **后端**：Python Flask框架提供RESTful API服务
- **前端**：Three.js实现3D渲染和交互
- **模型加载**：使用MMDLoader加载PMX模型
- **旋转控制**：基于时间增量的固定速度旋转算法
- **渲染优化**：黑色背景，适当的光照设置

## 注意事项

1. 确保MMD目录及其子目录有正确的读写权限
2. 大型模型文件可能需要较长的加载时间
3. 某些复杂的MMD模型可能需要额外的纹理和资源文件
4. ZIP压缩包中应包含至少一个PMX文件

## 故障排除

- **模型加载失败**：检查模型文件是否完整，路径是否正确
- **后端服务启动失败**：确保Python和依赖包已正确安装
- **显示异常**：尝试刷新页面或清除浏览器缓存
- **性能问题**：对于复杂模型，可能需要降低浏览器其他标签页的活动

## 许可证

MIT License

## 更新日志

### 1.1.0
- 优化模型旋转控制，实现固定速度旋转（基于时间增量）
- 调整背景颜色为黑色，提升模型显示效果
- 优化UI控制按钮排列和功能
- 改进模型加载逻辑和错误处理

### 1.0.0
- 初始版本发布
- 支持PMX和ZIP格式模型
- 实现动态模型列表加载
- 优化模型显示和交互体验