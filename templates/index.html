<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMDÁÆÄÊòìÊòæÁ§∫</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #555;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .model-section {
            margin-bottom: 40px;
        }
        .model-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .model-list li {
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .model-list li .model-info-wrapper {
            flex: 1;
        }
        .model-list li:hover {
            background-color: #f9f9f9;
        }
        .model-list li:last-child {
            border-bottom: none;
        }
        .model-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .model-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        .view-model-btn {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
        }
        .view-model-btn:hover {
            background-color: #0052a3;
        }
        .intro-section {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .intro-section p {
            margin: 5px 0;
            color: #1565c0;
        }
        .no-models {
            padding: 30px;
            text-align: center;
            background-color: #f9f9f9;
            border: 1px dashed #ccc;
            border-radius: 8px;
            color: #666;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
    <!-- ÂºïÂÖ•ÂàóË°®Â§ÑÁêÜËÑöÊú¨ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">
    <script src="{{ url_for('static', filename='js/modelList.js') }}"></script>
</head>
<body>
    <div class="container">
        <!-- MMD ZIPÈÉ®ÂàÜ -->
        <div class="model-section">
            <h2>üìÅ MMDÂàóË°®</h2>
            <div class="loading">Ê≠£Âú®Âä†ËΩΩMMDÂàóË°®...</div>
            <ul class="model-list" style="display: none;">
                <!-- MMDÂàóË°®È°πÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
            </ul>
            <div class="no-models" style="display: none;">
                <p>ÂΩìÂâçÊ≤°ÊúâÂèØÁî®ÁöÑ</p>
            </div>
        </div>
        
        <!-- Êñá‰ª∂‰∏ä‰º†ÈÉ®ÂàÜ -->
        <div class="model-section">
            <h2>üì§ ‰∏ä‰º†MMD</h2>
            <div class="upload-section" style="margin-bottom: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border: 2px dashed #ccc; transition: border-color 0.3s;">
                <form id="upload-form" enctype="multipart/form-data">
                    <div style="margin-bottom: 15px;">
                        <label for="zip-file" style="display: block; margin-bottom: 8px; font-weight: bold;">ÈÄâÊã©ZIPÊñá‰ª∂Ôºö</label>
                        <input type="file" id="zip-file" name="file" accept=".zip" style="margin-bottom: 10px;">
                        <p style="font-size: 13px; color: #666; margin: 0;">ÊîØÊåÅZIPÊ†ºÂºèÁöÑMMDÊñá‰ª∂</p>
                    </div>
                    <button type="submit" class="upload-btn" style="background-color: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 16px;">
                        ‰∏ä‰º†Êñá‰ª∂
                    </button>
                </form>
                <div id="upload-progress" style="display: none; margin-top: 15px;">
                    <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <div style="width: 200px; height: 8px; background-color: #eee; border-radius: 4px; overflow: hidden;">
                            <div id="progress-bar" style="height: 100%; background-color: #4CAF50; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <span id="progress-text" style="margin-left: 10px; font-size: 14px;">0%</span>
                    </div>
                    <p id="upload-status" style="font-size: 13px; margin: 0;"></p>
                </div>
                <div id="upload-success" style="display: none; margin-top: 15px; padding: 10px; background-color: #d4edda; color: #155724; border-radius: 4px;">
                    <p style="margin: 0;"><i class="fas fa-check-circle"></i> <span id="success-message"></span></p>
                </div>
                <div id="upload-error" style="display: none; margin-top: 15px; padding: 10px; background-color: #f8d7da; color: #721c24; border-radius: 4px;">
                    <p style="margin: 0;"><i class="fas fa-exclamation-circle"></i> <span id="error-message"></span></p>
                </div>
            </div>
            
            <script>
                // Êñá‰ª∂‰∏ä‰º†Â§ÑÁêÜ
                document.getElementById('upload-form').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const fileInput = document.getElementById('zip-file');
                    const file = fileInput.files[0];
                    
                    if (!file) {
                        showError('ËØ∑ÈÄâÊã©Ë¶Å‰∏ä‰º†ÁöÑZIPÊñá‰ª∂');
                        return;
                    }
                    
                    if (!file.name.endsWith('.zip')) {
                        showError('Âè™ÊîØÊåÅZIPÊ†ºÂºèÊñá‰ª∂');
                        return;
                    }
                    
                    // ÈáçÁΩÆÊâÄÊúâÊ∂àÊÅØ
                    document.getElementById('upload-success').style.display = 'none';
                    document.getElementById('upload-error').style.display = 'none';
                    
                    // ÊòæÁ§∫ËøõÂ∫¶Êù°
                    const progressContainer = document.getElementById('upload-progress');
                    const progressBar = document.getElementById('progress-bar');
                    const progressText = document.getElementById('progress-text');
                    const statusText = document.getElementById('upload-status');
                    
                    progressContainer.style.display = 'block';
                    progressBar.style.width = '0%';
                    progressText.textContent = '0%';
                    statusText.textContent = 'Ê≠£Âú®‰∏ä‰º†Êñá‰ª∂...';
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    try {
                        const response = await fetch('/api/upload-model', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!response.ok) {
                            throw new Error('‰∏ä‰º†Â§±Ë¥•');
                        }
                        
                        progressBar.style.width = '100%';
                        progressText.textContent = '100%';
                        statusText.textContent = '‰∏ä‰º†ÂÆåÊàêÔºåÂ§ÑÁêÜ‰∏≠...';
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            showSuccess(`Êñá‰ª∂"${result.fileName}"‰∏ä‰º†ÊàêÂäüÔºÅ`);
                            // Ê∏ÖÁ©∫Êñá‰ª∂ËæìÂÖ•
                            fileInput.value = '';
                            // ÈáçÊñ∞Âä†ËΩΩÂàóË°®
                            setTimeout(() => {
                                if (window.loadModels) {
                                    window.loadModels();
                                }
                            }, 500);
                        } else {
                            showError(result.error || '‰∏ä‰º†Â§±Ë¥•');
                        }
                    } catch (error) {
                        showError('‰∏ä‰º†ËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØÔºö' + error.message);
                    } finally {
                        // Âª∂ËøüÈöêËóèËøõÂ∫¶Êù°
                        setTimeout(() => {
                            progressContainer.style.display = 'none';
                        }, 3000);
                    }
                });
                
                function showSuccess(message) {
                    document.getElementById('success-message').textContent = message;
                    document.getElementById('upload-success').style.display = 'block';
                }
                
                function showError(message) {
                    document.getElementById('error-message').textContent = message;
                    document.getElementById('upload-error').style.display = 'block';
                }
                
                // ÊãñÊãΩ‰∏ä‰º†ÊïàÊûú
                const uploadSection = document.querySelector('.upload-section');
                const fileInput = document.getElementById('zip-file');
                
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    uploadSection.addEventListener(eventName, preventDefaults, false);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                ['dragenter', 'dragover'].forEach(eventName => {
                    uploadSection.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    uploadSection.addEventListener(eventName, unhighlight, false);
                });
                
                function highlight() {
                    uploadSection.style.borderColor = '#4CAF50';
                    uploadSection.style.backgroundColor = '#e8f5e9';
                }
                
                function unhighlight() {
                    uploadSection.style.borderColor = '#ccc';
                    uploadSection.style.backgroundColor = '#f8f9fa';
                }
                
                uploadSection.addEventListener('drop', handleDrop, false);
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    
                    if (files.length > 0) {
                        const file = files[0];
                        if (file.name.endsWith('.zip')) {
                            fileInput.files = files;
                            showSuccess(`Â∑≤ÈÄâÊã©Êñá‰ª∂Ôºö${file.name}`);
                        } else {
                            showError('ËØ∑‰∏ä‰º†ZIPÊ†ºÂºèÊñá‰ª∂');
                        }
                    }
                }
            </script>
        </div>
    </div>
</body>
</html>